{
  "ID": "reddit-software engineer-senior-user-session-token-validation",
  "Title": "Efficient User Session Token Validation",
  "Statement": "Reddit handles millions of authenticated requests daily. Each request requires validating a user's session token to ensure they are logged in and their session is still active. Design and implement a `SessionManager` class that efficiently validates session tokens, considering the need for quick lookups, token expiry, and revocation.\n\n`SessionManager` class methods:\n- `__init__(self, token_expiry_seconds: int)`: Initializes the session manager with a token expiry duration.\n- `create_session(self, user_id: str, current_timestamp: int) -\u003e str`: Generates a unique session token for the given `user_id` and records its creation time. Returns the new token.\n- `is_valid_session(self, token: str, current_timestamp: int) -\u003e bool`: Checks if the given `token` is currently valid (exists and has not expired). If valid, return `True`; otherwise, `False`.\n- `revoke_session(self, token: str) -\u003e None`: Invalidates a specific token, making it unusable for future requests.\n\nConstraints:\n- Tokens must be unique.\n- Validation must be fast.\n- Efficient handling of token expiry and revocation.\n\nExample:\nmanager = SessionManager(token_expiry_seconds=300) # Tokens expire in 5 minutes\n\ntoken1 = manager.create_session(\"user1\", 1000) # current_timestamp = 1000\nprint(manager.is_valid_session(token1, 1200)) # True (1200 - 1000 \u003c 300)\nprint(manager.is_valid_session(token1, 1300)) # False (1300 - 1000 = 300, exactly at expiry or just past)\n\ntoken2 = manager.create_session(\"user2\", 1500)\nmanager.revoke_session(token2)\nprint(manager.is_valid_session(token2, 1500)) # False (revoked)",
  "Languages": [
    "python",
    "java",
    "cpp",
    "javascript",
    "go",
    "rust"
  ],
  "Stub": {
    "cpp": "#include \u003cstring\u003e\n#include \u003cunordered_map\u003e\n#include \u003cchrono\u003e\n#include \u003crandom\u003e\n#include \u003csstream\u003e\n#include \u003ciomanip\u003e\n\nclass SessionManager {\nprivate:\n    struct SessionInfo {\n        std::string userId;\n        long long createdAt;\n        bool revoked;\n\n        SessionInfo(const std::string\u0026 uid, long long createT) : userId(uid), createdAt(createT), revoked(false) {}\n    };\n\n    int tokenExpirySeconds_;\n    std::unordered_map\u003cstd::string, SessionInfo\u003e sessions_;\n    std::random_device rd_;\n    std::mt19937_64 generator_;\n\npublic:\n    SessionManager(int tokenExpirySeconds) :\n        tokenExpirySeconds_(tokenExpirySeconds),\n        generator_(rd_()) {}\n\n    std::string _generateToken() {\n        std::stringstream ss;\n        ss \u003c\u003c std::hex \u003c\u003c generator_(); // Simple token generation, could be more robust\n        return ss.str();\n    }\n\n    std::string createSession(const std::string\u0026 userId, long long currentTimestamp) {\n        // Your code here\n        return \"\";\n    }\n\n    bool isValidSession(const std::string\u0026 token, long long currentTimestamp) {\n        // Your code here\n        return false;\n    }\n\n    void revokeSession(const std::string\u0026 token) {\n        // Your code here\n    }\n};",
    "go": "package main\n\nimport (\n    \"crypto/rand\"\n    \"encoding/hex\"\n    \"sync\"\n)\n\ntype SessionInfo struct {\n    UserId string\n    CreatedAt int64\n    Revoked bool\n}\n\ntype SessionManager struct {\n    tokenExpirySeconds int\n    sessions map[string]*SessionInfo\n    mu sync.RWMutex\n}\n\nfunc NewSessionManager(tokenExpirySeconds int) *SessionManager {\n    return \u0026SessionManager{\n        tokenExpirySeconds: tokenExpirySeconds,\n        sessions: make(map[string]*SessionInfo),\n    }\n}\n\nfunc (sm *SessionManager) generateToken() string {\n    b := make([]byte, 16)\n    if _, err := rand.Read(b); err != nil {\n        return \"\"\n    }\n    return hex.EncodeToString(b)\n}\n\nfunc (sm *SessionManager) CreateSession(userId string, currentTimestamp int64) string {\n    // Your code here\n    return \"\"\n}\n\nfunc (sm *SessionManager) IsValidSession(token string, currentTimestamp int64) bool {\n    // Your code here\n    return false\n}\n\nfunc (sm *SessionManager) RevokeSession(token string) {\n    // Your code here\n}",
    "java": "import java.security.SecureRandom;\nimport java.util.Base64;\nimport java.util.concurrent.ConcurrentHashMap;\n\nclass SessionManager {\n    private final int tokenExpirySeconds;\n    private final ConcurrentHashMap\u003cString, SessionInfo\u003e sessions;\n    private static final SecureRandom secureRandom = new SecureRandom();\n    private static final Base64.Encoder base64Encoder = Base64.getUrlEncoder();\n\n    private static class SessionInfo {\n        String userId;\n        long createdAt;\n        boolean revoked;\n\n        public SessionInfo(String userId, long createdAt) {\n            this.userId = userId;\n            this.createdAt = createdAt;\n            this.revoked = false;\n        }\n    }\n\n    public SessionManager(int tokenExpirySeconds) {\n        this.tokenExpirySeconds = tokenExpirySeconds;\n        this.sessions = new ConcurrentHashMap\u003c\u003e();\n    }\n\n    private String generateToken() {\n        byte[] randomBytes = new byte[32];\n        secureRandom.nextBytes(randomBytes);\n        return base64Encoder.encodeToString(randomBytes);\n    }\n\n    public String createSession(String userId, long currentTimestamp) {\n        // Your code here\n        return null;\n    }\n\n    public boolean isValidSession(String token, long currentTimestamp) {\n        // Your code here\n        return false;\n    }\n\n    public void revokeSession(String token) {\n        // Your code here\n    }\n}",
    "javascript": "class SessionManager {\n    constructor(tokenExpirySeconds) {\n        this.tokenExpirySeconds = tokenExpirySeconds;\n        this.sessions = new Map(); // token -\u003e {userId: string, createdAt: number, revoked: boolean}\n    }\n\n    _generateToken() {\n        // A simple UUID-like generation for demonstration\n        return Math.random().toString(36).substring(2) + Date.now().toString(36);\n    }\n\n    createSession(userId, currentTimestamp) {\n        // Your code here\n        return '';\n    }\n\n    is_valid_session(token, currentTimestamp) {\n        // Your code here\n        return false;\n    }\n\n    revoke_session(token) {\n        // Your code here\n    }\n}",
    "python": "import hashlib\nimport os\nfrom typing import Dict\n\nclass SessionManager:\n    def __init__(self, token_expiry_seconds: int):\n        self.token_expiry_seconds = token_expiry_seconds\n        self.sessions = {} # type: Dict[str, dict] # token -\u003e {user_id: str, created_at: int, revoked: bool}\n\n    def _generate_token(self) -\u003e str:\n        return hashlib.sha256(os.urandom(64)).hexdigest()\n\n    def create_session(self, user_id: str, current_timestamp: int) -\u003e str:\n        # Your code here\n        pass\n\n    def is_valid_session(self, token: str, current_timestamp: int) -\u003e bool:\n        # Your code here\n        pass\n\n    def revoke_session(self, token: str) -\u003e None:\n        # Your code here\n        pass",
    "rust": "use std::collections::HashMap;\nuse std::time::{Instant, Duration};\nuse rand::Rng;\nuse hex;\n\npub struct SessionInfo {\n    user_id: String,\n    created_at: Instant,\n    revoked: bool,\n}\n\npub struct SessionManager {\n    token_expiry_duration: Duration,\n    sessions: HashMap\u003cString, SessionInfo\u003e,\n}\n\nimpl SessionManager {\n    pub fn new(token_expiry_seconds: u64) -\u003e Self {\n        SessionManager {\n            token_expiry_duration: Duration::from_secs(token_expiry_seconds),\n            sessions: HashMap::new(),\n        }\n    }\n\n    fn generate_token(\u0026self) -\u003e String {\n        let random_bytes: Vec\u003cu8\u003e = (0..32).map(|_| rand::thread_rng().gen::\u003cu8\u003e()).collect();\n        hex::encode(random_bytes)\n    }\n\n    pub fn create_session(\u0026mut self, user_id: String, current_instant: Instant) -\u003e String {\n        // Your code here\n        String::new()\n    }\n\n    pub fn is_valid_session(\u0026self, token: \u0026str, current_instant: Instant) -\u003e bool {\n        // Your code here\n        false\n    }\n\n    pub fn revoke_session(\u0026mut self, token: \u0026str) {\n        // Your code here\n    }\n}"
  },
  "Type": "coding"
}